# Helsinki City Bike App

An application where you can view journey details and station details generated by bikes in Helsinki Capital area.

Dataset is downloaded from here:

- https://dev.hsl.fi/citybikes/od-trips-2021/2021-05.csv
- https://dev.hsl.fi/citybikes/od-trips-2021/2021-06.csv
- https://dev.hsl.fi/citybikes/od-trips-2021/2021-07.csv

License and Other helpful info:

- Dataset: https://opendata.arcgis.com/datasets/726277c507ef4914b0aec3cbcfcbfafc_0.csv
- License and information: https://www.avoindata.fi/data/en/dataset/hsl-n-kaupunkipyoraasemat/resource/a23eef3a-cc40-4608-8aa2-c730d17e8902

## Tech used

### Backend
* [Node.js](https://nodejs.org/)
* [Express](https://expressjs.com/)
* [TypeScript](https://www.typescriptlang.org/)
* [Docker](https://www.docker.com/)
* [Morgan](https://expressjs.com/en/resources/middleware/morgan.html)
* [Git](https://git-scm.com/)

### Frontend
* [ReactJs](https://react.dev/)
* [MaterialUI](https://mui.com/)
* [Axios](https://axios-http.com/docs/intro)
* [Tanstack query](https://tanstack.com/query/v3/)

### Storage
* [PostgreSQL](https://www.postgresql.org/)
* [Prisma ORM](https://www.prisma.io/)

### Testing
* [Jest](https://www.chaijs.com/)
* [Supertest](https://www.npmjs.com/package/supertest)
* [Cypress](https://www.cypress.io/)

## Running the app

Docker can be used to setup the dev environment. Make sure you have docker installed and running.
To start dev server simply run the following command in terminal opened in root of project directory:

```
docker compose -f docker-compose.dev.yml up
```
after running the above command the app will be live on `http://localhost:3000/`

## Running the tests

Again for testing separate docker file has been created. To run the test simply run the following command.

```
docker compose -f docker-compose.test.yml up
```
The above command will run the e2e test automaticaly but to run unit test you need to open the bash for the container `backend-test` with the following command:

```
docker exec -it backend-test bash
```

After running above command you can access the terminal to the backend server and unit test can be run by `npm run test`

## API Documentation

### Journeys API

1. `/api/journeys`  return journey details and total journeys records.
 
 - `?take=10&?page=2` both "take"(number of records) and "page"(page number) are required.
 - `?sort_prop=duration&order=asc` 
 - `?filter_prop=departure_station_id&id=512`

### Stations API

1. `/api/stations/`  return stations details and total count of records.

 - `?take=10&?page=2`
    </br>
    </br>
    Both `take` and `page` are required field and can be of type `integer`.
    </br>
    </br>
    Example request `/api/stations/?take=10&?page=2`
    </br>
    </br>
    Example response:
    </br>
    </br>
    ```json
    {
    "count": 457,   // total number of records
    "details": [
        {
            "id": 4,
            "name": "Viiskulma",
            "address": "Fredriksgatan  19",
            "city": "Espoo",
            "operator": "CityBike Finland",
            "capacity": 14,
            "x": "24.9417758006418",
            "y": "60.1609858921764"
        },
        {
            "id": 5,
            "name": "Sep채nkatu",
            "address": "Fabriksgatan 25",
            "city": "Espoo",
            "operator": "CityBike Finland",
            "capacity": 32,
            "x": "24.9362853002102",
            "y": "60.157948291819"
        },
        {
            "id": 6,
            "name": "Hietalahdentori",
            "address": "Sandviksgatan 2",
            "city": "Espoo",
            "operator": "CityBike Finland",
            "capacity": 24,
            "x": "24.9296476311878",
            "y": "60.1622283898112"
        }
    ]
}
    ```

2. `/api/stations/search`  return station list corresponding to `query` param

 - `?query=aa`
    </br>
    </br>
   `query` is required field and can be of type `string`.
    </br>
    </br>
    Example request `/api/stations/search?query=aa`
    </br>
    </br>
    Example response:
    </br>
    </br>
    ```json
    [
    {
        "id": 539,
        "name": "Aalto University (M), Tietotie"
    },
    {
        "id": 541,
        "name": "Aalto University (M), Korkeakoulua"
    }
]
    ```

   

3. `/api/stations/${id}` return details of station whose id is provided

 - `id` is of type integer.
  </br>
  </br>
 Example request `/api/stations/12`
  </br>
  </br>
Example response:
    </br>
    </br>
```
 {
    "details": {
        "id": 12,
        "name": "Kanavaranta",
        "address": "Kanalkajen 1",
        "city": "Espoo",
        "operator": "CityBike Finland",
        "capacity": 34,
        "x": "24.9584922784237",
        "y": "60.1684959040351"
    },
    "total_departures": 15310,   // total journeys started from station
    "total_return": 15724,       // total journeys ended at station
    "avg_departure_distance": "2569.2210333115610712",  // average distance in meters
    "avg_return_distance": "2531.6398499109641313",     // average return distance in meters
    "popular_departure_stations": [
        {
            "_count": {
                "return_station_id": 612
            },
            "departure_station_id": 123,
            "departure_station_name": "N채kinsilta"
        },
        {
            "_count": {
                "return_station_id": 610
            },
            "departure_station_id": 1,
            "departure_station_name": "Kaivopuisto"
        },
        {
            "_count": {
                "return_station_id": 604
            },
            "departure_station_id": 16,
            "departure_station_name": "Liisanpuistikko"
        },
        {
            "_count": {
                "return_station_id": 490
            },
            "departure_station_id": 40,
            "departure_station_name": "Hakaniemi (M)"
        },
        {
            "_count": {
                "return_station_id": 472
            },
            "departure_station_id": 122,
            "departure_station_name": "Lintulahdenkatu"
        }
    ],
    "popular_return_station": [
        {
            "_count": {
                "departure_station_id": 633
            },
            "return_station_id": 16,
            "return_station_name": "Liisanpuistikko"
        },
        {
            "_count": {
                "departure_station_id": 584
            },
            "return_station_id": 123,
            "return_station_name": "N채kinsilta"
        },
        {
            "_count": {
                "departure_station_id": 583
            },
            "return_station_id": 40,
            "return_station_name": "Hakaniemi (M)"
        },
        {
            "_count": {
                "departure_station_id": 528
            },
            "return_station_id": 41,
            "return_station_name": "Ympyr채talo"
        },
        {
            "_count": {
                "departure_station_id": 504
            },
            "return_station_id": 121,
            "return_station_name": "Vilhonvuorenkatu"
        }
    ]
}

```


## Further scope of improvements



 - Functionality to add stations with help of GooglePlaces API.
 - Functionality to add journeys.
 - Cypress test can be moved into its own folder.
 - Performance can be improved using hooks like `useMemo` and `useCallback`. 
 - Adding authentication so that only some privileged user can add stations and journeys.
 - More validations can be added to database.
 - Relations can be added to database. 
 - Swagger can be added for  API management.




